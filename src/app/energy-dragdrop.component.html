<div class="container">
  <h2>Arraste os eletrodomÃ©sticos para o retÃ¢ngulo</h2>

  <!-- Dropdown de Estados -->
  <div class="state-selector">
    <label for="state">Selecione o Estado:</label>
    <select id="state" [(ngModel)]="selectedState" (change)="updateTarifa()">
      <option *ngFor="let state of states" [value]="state.code">{{ state.name }}</option>
    </select>
  </div>

  <!-- Texto bÃ¡sico -->
  <div class="state-selector">
    <p class="simple-text">*lembrando que isso Ã© uma estimativa, para melhor precisÃ£o confirme a tarifa da sua regiÃ£o</p>
  </div>

  <!-- Galeria -->
  <div class="gallery">
    <div *ngFor="let key of applianceKeys" class="appliance" draggable="true"
         (dragstart)="onDragStart($event,key)">
      <img [src]="appliances[key].image" [alt]="appliances[key].label" />
      <p>{{ appliances[key].label }}</p>
    </div>
  </div>

  <!-- Ãrea de drop -->
  <div class="dropzone" (dragover)="$event.preventDefault()" (drop)="onDrop($event)">
    <ng-container *ngIf="selectedAppliances.length === 0">
      <p>Arraste aqui</p>
    </ng-container>

    <div *ngFor="let key of selectedAppliances" class="preview-area">
      <img [src]="appliances[key].image" [alt]="appliances[key].label" />
      <div class="info">
        <p><strong>{{ appliances[key].label }}</strong></p>
        <p><strong>PotÃªncia (W):</strong>
          <input type="number" [(ngModel)]="usage[key].powerW" (input)="recalculate()" /> W
        </p>
        <p><strong>Uso por dia:</strong>
          <input type="number" [(ngModel)]="usage[key].hoursPerDay" (input)="recalculate()" /> horas/dia
        </p>
        <p><strong>Tarifa / kWh:</strong>
          <input type="number" [(ngModel)]="usage[key].costPerKwh" (input)="recalculate()" /> BRL
        </p>
        <button (click)="removeAppliance(key)">Remover</button>
      </div>
    </div>
  </div>

  <!-- GrÃ¡fico e insights -->
  <div *ngIf="selectedAppliances.length > 0" class="charts">
    <h3>Consumo de Energia e Custo</h3>
    <canvas baseChart
      [data]="barChartData"
      [options]="barChartOptions"
      [type]="'bar'"
      style="width: 100%; max-width: 900px; height: 450px;">
    </canvas>

    <div class="insights-container">
      <div class="insight-card">
        <h3>ğŸ”‹ Consumo total</h3>
        <p>{{ consumoTotal }} kWh/semana</p>
      </div>
      <div class="insight-card">
        <h3>ğŸ’¡ Mais econÃ´mico</h3>
        <p>{{ maisEconomico.nome }} - {{ maisEconomico.valor }} kWh</p>
      </div>
      <div class="insight-card">
        <h3>ğŸ“‰ MÃ©dia por aparelho</h3>
        <p>{{ mediaConsumo }} kWh</p>
      </div>
      <div class="insight-card">
        <h3>ğŸ“Š ParticipaÃ§Ã£o</h3>
        <ul>
          <li *ngFor="let item of participacao">{{ item.nome }}: {{ item.porcentagem }}%</li>
        </ul>
      </div>
      <div class="insight-card">
        <h3>ğŸ’° MÃ©dia diÃ¡ria</h3>
        <p>R$ {{ mediaDiaria }}</p>
      </div>
      <div class="insight-card">
        <h3>ğŸ“† ProjeÃ§Ã£o mensal</h3>
        <p>R$ {{ projecaoMensal }}</p>
      </div>
      <div class="insight-card">
        <h3>âš–ï¸ DiferenÃ§a</h3>
        <p>R$ {{ diferenca }}</p>
      </div>
      <div class="insight-card">
        <h3>ğŸ† Ranking</h3>
        <ol>
          <li *ngFor="let item of ranking">{{ item.nome }} - {{ item.valor }} kWh</li>
        </ol>
      </div>
      <div class="insight-card">
        <h3>ğŸ’¡ Economia possÃ­vel</h3>
        <p>Desligar {{ maiorGastao.nome }} 1h â†’ economiza {{ economia }} kWh</p>
      </div>
      <div class="insight-card">
        <h3>â±ï¸ Consumo/hora</h3>
        <p>{{ consumoPorHora }} kWh</p>
      </div>
      <div class="insight-card">
        <h3>ğŸ“Š Variabilidade (Desvio PadrÃ£o)</h3>
        <p>{{ desvioPadraoConsumo }} kWh</p>
        <small>Indica a dispersÃ£o do consumo entre os aparelhos. Um valor alto significa que alguns aparelhos gastam muito mais que a mÃ©dia.</small>
      </div>
      <div class="insight-card">
        <h3>ğŸ“† ProjeÃ§Ã£o Mensal (Estimativa)</h3>
        <p>R$ {{ projecaoMensal }}</p>
        <small *ngIf="selectedAppliances.length > 1">
          Com 95% de confianÃ§a, seu gasto ficarÃ¡ entre <strong>R$ {{ projecaoMensalMin }}</strong> e <strong>R$ {{ projecaoMensalMax }}</strong>.
        </small>
      </div>
      <div *ngIf="savingsTips.length > 0" class="tips-container">
        <h3>ğŸ’¡ Dicas de Economia Personalizadas</h3>
        <ul>
          <li *ngFor="let tip of savingsTips">{{ tip }}</li>
        </ul>
      </div>
    </div>
  </div>
</div>
